<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <!-- è¨­å®šä¸­æ–‡èˆ‡æ‰‹æ©Ÿ/é›»è…¦çš†èƒ½è‡ªå‹•ç¸®æ”¾ -->
  <title>æª”æ¡ˆè½‰æ›å™¨ Â· å¸¥æ°£ç‰ˆ</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
  <script>
    // ä»¥ä¸‹æ˜¯å®šç¾©ä¸»è‰²ï¼ˆç´«è—+è¢å…‰è—ï¼‰ã€æ·±æ·ºæ¨¡å¼å°æ‡‰é¡è‰²ã€åœ“è§’ã€é™°å½±èˆ‡å‹•ç•«
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#7c5cff",        // æ›´æ½®çš„ç´«è—ä¸»è‰²
            accent:  "#19c5ff",        // è¢å…‰è—é»ç¶´
            surface: {
              light: "#ffffff",
              dark:  "#12151b",
            },
            base: {
              light: "#f6f7fb",
              dark:  "#0b0e13",
            },
            line: {
              light: "#e6e8ef",
              dark:  "#222834",
            },
            text: {
              light: "#0f1320",
              dark:  "#eef2ff",
            },
            mute: {
              light: "#6b7280",
              dark:  "#9aa5b1",
            },
          },
          fontFamily: { display: ["Manrope", "ui-sans-serif", "system-ui"] },
          borderRadius: { DEFAULT: "0.75rem", lg: "1rem", xl: "1.25rem", full: "9999px" },
          boxShadow: {
            glass: "0 10px 30px -10px rgba(0,0,0,.35)",
            inset: "inset 0 1px 0 rgba(255,255,255,.08)",
          },
          backdropBlur: { xs: '2px' },
          keyframes: {
            float: { '0%,100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-6px)' } },
            pingSlow: { '0%': { transform: 'scale(1)', opacity: .8 }, '100%': { transform: 'scale(1.6)', opacity: 0 } }
          },
          animation: {
            float: 'float 6s ease-in-out infinite',
            pingSlow: 'pingSlow 2.5s ease-out infinite',
          }
        }
      }
    }
  </script>

     <!-- .glass ç”¢ç”Ÿæ¯›ç»ç’ƒæ•ˆæœ -->
     <!-- .scroll-smooth å•Ÿç”¨å¹³æ»‘æ»¾å‹• -->
  <style>
    .material-symbols-outlined{font-variation-settings:'FILL' 0,'wght' 500,'GRAD' 0,'opsz' 24}
    .glass{backdrop-filter:saturate(140%) blur(10px)}
    .scroll-smooth{scroll-behavior:smooth}
  </style>
</head>
<body class="scroll-smooth font-display text-text-light dark:text-text-dark bg-base-light dark:bg-base-dark">
  <!-- èƒŒæ™¯è£é£¾ï¼šæ¼¸å±¤æ°£æ³¡ -->
  <div aria-hidden="true" class="pointer-events-none fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-24 -right-24 size-[26rem] rounded-full bg-gradient-to-br from-primary to-accent opacity-20 blur-[80px] animate-float"></div>
    <div class="absolute -bottom-32 -left-20 size-[30rem] rounded-full bg-gradient-to-tr from-[#00f0ff] to-[#9b5cff] opacity-15 blur-[90px] animate-float" style="animation-delay:1.2s"></div>
  </div>

  <!-- é ‚éƒ¨å°è¦½ -->
  <header class="sticky top-0 z-30 border-b border-line-light/70 dark:border-line-dark/80 bg-surface-light/70 dark:bg-surface-dark/60 glass">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center gap-3">
          <div class="relative">
            <div class="size-9 rounded-xl bg-gradient-to-br from-primary to-accent grid place-items-center shadow-glass">
              <span class="material-symbols-outlined text-white">auto_awesome</span>
            </div>
            <span class="absolute -right-1 -top-1 size-3 rounded-full bg-accent/80 animate-pingSlow"></span>
          </div>
          <h1 class="text-lg sm:text-xl font-extrabold tracking-tight">æª”æ¡ˆè½‰æ›å™¨</h1>
          <span class="hidden sm:inline text-mute-light dark:text-mute-dark">Â· PDF âŸ¶ InDesign</span>
        </div>
        <div class="flex items-center gap-2">
          <button id="themeToggle" class="group relative p-2 rounded-lg border border-line-light dark:border-line-dark bg-surface-light/70 dark:bg-surface-dark/70 hover:border-accent/60 hover:shadow-glass transition">
            <span class="material-symbols-outlined block dark:hidden">dark_mode</span>
            <span class="material-symbols-outlined hidden dark:block">light_mode</span>
          </button>
          <a href="#upload" class="hidden sm:inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-primary to-accent text-white font-bold shadow-glass hover:opacity-95 transition">
            <span class="material-symbols-outlined text-[18px]">cloud_upload</span> é–‹å§‹ä¸Šå‚³
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- ä¸»é«”å€ -->
  <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 grid lg:grid-cols-[1fr,380px] gap-8">
    <!-- å°è©± + ä¸Šå‚³ -->
    <section class="space-y-6">
      <!-- hero å¡ç‰‡ -->
      <div class="relative rounded-xl border border-line-light dark:border-line-dark bg-surface-light/80 dark:bg-surface-dark/70 glass shadow-glass p-6 overflow-hidden">
        <!-- èƒŒæ™¯è£é£¾ç§»åˆ°æ›´ä½å±¤ç´šï¼Œé¿å…å£“åˆ°å…§å®¹ -->
        <div class="pointer-events-none absolute -right-10 -top-10 size-40 rounded-full bg-gradient-to-br from-primary to-accent opacity-20 blur-2xl -z-10"></div>

        <!-- å…©æ¬„ï¼šå·¦ LOGOã€å³ æ–‡å­—ï¼›å°è¢å¹•è‡ªå‹•æ›è¡Œ -->
        <div class="relative grid grid-cols-[auto,1fr] gap-4 items-center">
          <!-- LOGO å€ï¼šå›ºå®šå°ºå¯¸ä¸å£“ç¸®ï¼Œé¿å…èˆ‡æ¨™é¡Œäº’ç›¸æ’ä½ -->
          <!-- <div class="shrink-0 size-14 sm:size-16 rounded-2xl bg-gradient-to-br from-primary/90 to-accent/90 p-0.5">
            <div class="size-full rounded-[1rem] bg-surface-light dark:bg-surface-dark grid place-items-center">
              <img src="https://dummyimage.com/80x80/000/fff&text=RK" alt="Brand" class="w-9 sm:w-10 h-9 sm:h-10 object-contain"/>
            </div> -->
          </div>

          <!-- æ–‡æ¡ˆå€ï¼šmin-w-0 é˜²æ­¢æ–‡å­—æŠŠ LOGO æ“ çˆ†ï¼›é•·å­—æœƒæ›è¡Œ -->
          <div class="min-w-0">
            <h2 class="text-2xl sm:text-3xl font-extrabold leading-tight break-words">ä¸€éµå°‡ PDF è½‰æˆå¯ç·¨è¼¯çš„ InDesign</h2>
            <p class="mt-1 text-mute-light dark:text-mute-dark">è¼¸å…¥ä½ çš„ <strong>è½‰æ›è¦å‰‡</strong>ï¼ˆæ®µè½æ¨£å¼ã€å­—å…ƒæ¨£å¼ã€åœ–ç‰‡éŒ¨é™„â€¦ï¼‰ï¼Œä¸Šå‚³ PDFï¼Œå³å¯ç”¢ç”Ÿ INDD/IDMLã€‚</p>
          </div>
        </div>
      </div>

      <!-- å°è©±ä¸² -->
      <div class="space-y-5">
        <!-- åŠ©ç†æ³¡æ³¡ -->
        <div class="flex items-start gap-3">
          <div class="size-10 rounded-xl bg-primary/15 text-primary grid place-items-center border border-primary/20 shrink-0"><span class="material-symbols-outlined">robot_2</span></div>
          <div class="max-w-[78%] rounded-2xl rounded-tl-md p-4 border bg-surface-light/80 dark:bg-surface-dark/70 border-line-light dark:border-line-dark glass shadow-glass">
            <p class="font-bold text-primary mb-1">è½‰æ›åŠ©ç†</p>
            <p>æ­¡è¿ï¼å…ˆæä¾›ä½ çš„ <strong>è½‰æ›è¦å‰‡</strong>ï¼Œä¾‹å¦‚ï¼š
              <code class="px-1 py-0.5 rounded bg-base-light dark:bg-base-dark">æ¨™é¡Œä¸€ â†’ H1</code>ã€
              <code class="px-1 py-0.5 rounded bg-base-light dark:bg-base-dark">å¼·èª¿ â†’ Bold</code>ã€‚
            </p>
          </div>
        </div>
        <!-- ä½¿ç”¨è€…æ³¡æ³¡ -->
        <div class="flex items-start gap-3 justify-end">
          <div class="max-w-[78%] rounded-2xl rounded-tr-md p-4 border bg-gradient-to-br from-primary/95 to-accent/90 text-white border-transparent shadow-glass">
            <p>æ®µè½æ¨£å¼ï¼šä¸»æ¨™é¡Œâ†’H1ã€å‰¯æ¨™é¡Œâ†’H2ã€å…§æ–‡â†’Bodyï¼›å­—å…ƒæ¨£å¼ï¼šå¼·èª¿â†’Boldã€å¼•ç”¨â†’Italicã€‚</p>
          </div>
          <div class="size-10 rounded-xl grid place-items-center bg-white/20 text-white border border-white/30 dark:bg-surface-dark/70 dark:border-line-dark shrink-0"><span class="material-symbols-outlined">person</span></div>
        </div>
        <!-- åŠ©ç†æ³¡æ³¡ 2 -->
        <div class="flex items-start gap-3">
          <div class="size-10 rounded-xl bg-primary/15 text-primary grid place-items-center border border-primary/20 shrink-0"><span class="material-symbols-outlined">robot_2</span></div>
          <div class="w-full rounded-2xl rounded-tl-md p-4 border bg-surface-light/80 dark:bg-surface-dark/70 border-line-light dark:border-line-dark glass shadow-glass">
            <p class="font-bold text-primary mb-2">å·²å¥—ç”¨è¦å‰‡ï¼Œè«‹ä¸Šå‚³ PDF</p>
            <a id="upload" class="block"></a>
            <label for="file-upload" class="group cursor-pointer grid place-items-center gap-3 text-center p-8 border-2 border-dashed rounded-xl transition bg-base-light/60 dark:bg-base-dark/50 hover:border-accent/70">
              <span class="material-symbols-outlined text-5xl text-mute-light dark:text-mute-dark group-hover:scale-105 transition">cloud_upload</span>
              <div>
                <p class="text-base font-semibold">æ‹–æ”¾ PDF è‡³æ­¤ï¼Œæˆ– <span class="text-accent">é»æ­¤é¸æ“‡æª”æ¡ˆ</span></p>
                <p class="text-sm text-mute-light dark:text-mute-dark">æ”¯æ´ .pdfï¼ˆæƒææª”å°‡è‡ªå‹• OCRï¼‰</p>
              </div>
              <input id="file-upload" type="file" accept=".pdf" class="hidden"/>
            </label>
          </div>
        </div>
      </div>

      <!-- ç½®åº•è¼¸å…¥åˆ— -->
      <div class="sticky bottom-4">
        <div class="rounded-2xl border bg-surface-light/80 dark:bg-surface-dark/70 border-line-light dark:border-line-dark glass shadow-glass p-2 flex items-end gap-2">
          <textarea id="rules" rows="1" placeholder="è¼¸å…¥è½‰æ›è¦å‰‡ï¼ˆæ”¯æ´å¤šè¡Œï¼‰ï¼ŒæŒ‰ Enter é€å‡ºâ€¦" class="flex-grow bg-transparent border-0 focus:ring-0 resize-none p-3 text-[15px] placeholder:text-mute-light dark:placeholder:text-mute-dark"></textarea>
          <button id="send" class="group relative inline-flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-primary to-accent text-white font-bold shadow-glass hover:opacity-95 transition">
            <span class="material-symbols-outlined">send</span>
          </button>
        </div>
      </div>
    </section>

    <!-- å´é‚Šï¼šè¨­å®š/ç‹€æ…‹å¡ -->
    <aside class="space-y-6">
      <div class="rounded-xl border bg-surface-light/80 dark:bg-surface-dark/70 border-line-light dark:border-line-dark glass shadow-glass p-5">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-extrabold">è½‰æ›è¨­å®š</h3>
          <span class="text-xs px-2 py-1 rounded-full bg-primary/15 text-primary border border-primary/20">Beta</span>
        </div>
        <div class="mt-4 space-y-4">
          <label class="flex items-center justify-between text-sm">
            <span class="text-mute-light dark:text-mute-dark">è¼¸å‡ºæ ¼å¼</span>
            <select class="rounded-lg bg-base-light/60 dark:bg-base-dark/60 border-line-light dark:border-line-dark">
              <option>INDDï¼ˆéœ€ InDesignï¼‰</option>
              <option>IDMLï¼ˆç„¡é ­ï¼‰</option>
            </select>
          </label>
          <label class="flex items-center justify-between text-sm">
            <span class="text-mute-light dark:text-mute-dark">OCRï¼ˆæƒææª”ï¼‰</span>
            <input type="checkbox" class="rounded border-line-light dark:border-line-dark text-primary focus:ring-primary" checked>
          </label>
          <label class="flex items-center justify-between text-sm">
            <span class="text-mute-light dark:text-mute-dark">è‡ªå‹•å¥—ç”¨æ¨£å¼</span>
            <input type="checkbox" class="rounded border-line-light dark:border-line-dark text-primary focus:ring-primary" checked>
          </label>
        </div>
      </div>

      <div class="rounded-xl border bg-surface-light/80 dark:bg-surface-dark/70 border-line-light dark:border-line-dark glass shadow-glass p-5">
        <h3 class="text-lg font-extrabold">è½‰æ›ç‹€æ…‹</h3>
        <ul class="mt-3 space-y-2 text-sm">
          <li class="flex items-center gap-2"><span class="material-symbols-outlined text-primary">task_alt</span> è¦å‰‡æ ¡é©—</li>
          <li class="flex items-center gap-2"><span class="material-symbols-outlined text-primary">auto_fix</span> ç‰ˆé¢åµæ¸¬</li>
          <li class="flex items-center gap-2"><span class="material-symbols-outlined text-primary">calendar_view_month</span> JSON ç”Ÿæˆ</li>
          <li class="flex items-center gap-2"><span class="material-symbols-outlined text-primary">format_shapes</span> INDD/IDML ç”¢å‡º</li>
        </ul>
      </div>

      <div class="rounded-xl border bg-surface-light/80 dark:bg-surface-dark/70 border-line-light dark:border-line-dark glass shadow-glass p-5">
        <h3 class="text-lg font-extrabold">å¿«é€Ÿæç¤º</h3>
        <ul class="mt-3 list-disc pl-5 text-sm text-mute-light dark:text-mute-dark space-y-1">
          <li><strong>H1/H2/H3</strong> å°æ‡‰åˆ°ã€Œæ®µè½æ¨£å¼ã€ã€‚</li>
          <li><strong>Bold/Italic</strong> å°æ‡‰åˆ°ã€Œå­—å…ƒæ¨£å¼ã€ã€‚</li>
          <li>åœ–ç‰‡è‹¥éœ€éŒ¨é™„ï¼š<code class="px-1 py-0.5 rounded bg-base-light dark:bg-base-dark">Figure(anchor:inline)</code></li>
        </ul>
      </div>
    </aside>
  </main>



  <!-- åº•éƒ¨ -->
  <footer class="mt-8 border-t border-line-light dark:border-line-dark/80 py-8 text-center text-sm text-mute-light dark:text-mute-dark">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
      <p>Â© 2025 ConvertFast Â· All rights reserved.</p>
    </div>
  </footer>


    <!-- ğŸ“¥ ä¸‹è¼‰çµæœ -->
  <div id="download-section" class="hidden fixed bottom-6 right-6 z-50">
    <a id="download-btn"
      href="/download/result.json"
      download="result.json"
      class="inline-flex items-center gap-2 px-5 py-3 rounded-full bg-gradient-to-r from-primary to-accent text-white font-bold shadow-glass hover:opacity-95 transition">
      <span class="material-symbols-outlined text-[20px]">download</span>
      ä¸‹è¼‰çµæœ JSON
    </a>
  </div>
  <!-- ğŸ”„ è™•ç†é€²åº¦æ¢ -->
<div id="progress-modal" class="hidden fixed inset-0 flex items-center justify-center bg-black/50 z-50">
  <div class="w-[300px] rounded-xl bg-surface-light dark:bg-surface-dark p-6 shadow-glass text-center">
    <p id="progress-text" class="font-semibold text-primary mb-3">æ­£åœ¨è™•ç†ä¸­...</p>
    <div class="w-full bg-line-light dark:bg-line-dark rounded-full h-3 overflow-hidden">
      <div id="progress-bar" class="bg-gradient-to-r from-primary to-accent h-full w-0 transition-all duration-300"></div>
    </div>
  </div>
</div>

<!-- ğŸ”” å…¨åŸŸæç¤ºæ¢ -->
<div id="toast" class="hidden fixed top-5 left-1/2 -translate-x-1/2 px-6 py-3 rounded-lg text-white font-semibold shadow-glass z-[100] transition-all duration-500 opacity-0"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  // ---------- Toast å‡½å¼ ----------
  const toast = document.getElementById('toast');
  function showToast(msg, type = 'info') {
    toast.textContent = msg;
    toast.classList.remove('hidden', 'opacity-0');
    toast.style.backgroundColor =
      type === 'success' ? '#16a34a' : type === 'error' ? '#dc2626' : '#2563eb';
    toast.classList.add('opacity-100');
    setTimeout(() => toast.classList.add('opacity-0'), 2500);
    setTimeout(() => toast.classList.add('hidden'), 3000);
  }

  // ---------- ä¸»é¡Œåˆ‡æ› ----------
  const root = document.documentElement;
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && prefersDark)) {
    root.classList.add('dark');
  }
  document.getElementById('themeToggle').addEventListener('click', () => {
    root.classList.toggle('dark');
    localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
  });

  // ---------- è¼¸å…¥æ¡† ----------
  const ta = document.getElementById('rules');
  const sendBtn = document.getElementById('send');
  function autosize() { ta.style.height = 'auto'; ta.style.height = ta.scrollHeight + 'px'; }
  ['input', 'change'].forEach(e => ta.addEventListener(e, autosize));
  ta.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendBtn.click(); }
  });

  // ---------- å³ä¸Šè§’ä¸Šå‚³ ----------
  const uploadBtnTop = document.querySelector('a[href="#upload"]');
  if (uploadBtnTop) uploadBtnTop.addEventListener('click', e => {
    e.preventDefault();
    document.getElementById('file-upload').click();
  });

  // ---------- ä¸Šå‚³ ----------
  let uploadedFilename = "";
  const fileInput = document.getElementById('file-upload');
  const dropZone = document.querySelector('label[for="file-upload"]');

  fileInput.addEventListener('change', async () => {
    const file = fileInput.files[0];
    if (!file) return;
    const formData = new FormData();
    formData.append('file', file);

    try {
      const res = await fetch('/upload', { method: 'POST', body: formData });
      let data = {};
      try { data = await res.json(); } catch { data = { error: 'ä¼ºæœå™¨å›å‚³é JSON æ ¼å¼' }; }

      if (res.ok) {
        uploadedFilename = data.filename || file.name;
        const infoHTML = `
          <div class="flex flex-col items-center justify-center gap-3 p-6 text-center">
            <span class="material-symbols-outlined text-5xl text-primary">check_circle</span>
            <p class="font-semibold text-primary">å·²æˆåŠŸä¸Šå‚³</p>
            <p class="text-sm text-mute-light dark:text-mute-dark">${uploadedFilename}</p>
          </div>`;
        dropZone.querySelector('div').innerHTML = infoHTML;
        dropZone.classList.remove('border-dashed');
        dropZone.classList.add('border-solid', 'border-primary/60');
        showToast("âœ… å·²æˆåŠŸä¸Šå‚³", "success");
      } else {
        showToast(data.error || "âŒ ä¸Šå‚³å¤±æ•—", "error");
      }
    } catch {
      showToast("âŒ ä¸Šå‚³ç™¼ç”ŸéŒ¯èª¤", "error");
    }
  });

  // ---------- æ‹–æ›³ä¸Šå‚³ ----------
  ['dragenter','dragover','dragleave','drop'].forEach(ev => {
    dropZone.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); });
  });
  ['dragenter','dragover'].forEach(ev => dropZone.addEventListener(ev, () => dropZone.classList.add('border-accent')));
  ['dragleave','drop'].forEach(ev => dropZone.addEventListener(ev, () => dropZone.classList.remove('border-accent')));
  dropZone.addEventListener('drop', e => {
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      fileInput.files = files;
      fileInput.dispatchEvent(new Event('change'));
    }
  });

  // ---------- å‚³é€è½‰æ›è¦å‰‡ ----------
  sendBtn.addEventListener('click', async () => {
    const rules = ta.value.trim();
    if (!rules) return showToast("è«‹è¼¸å…¥è½‰æ›è¦å‰‡ï¼", "error");
    if (!uploadedFilename) return showToast("è«‹å…ˆä¸Šå‚³ PDF æª”æ¡ˆï¼", "error");

    const modal = document.getElementById('progress-modal');
    const bar = document.getElementById('progress-bar');
    const text = document.getElementById('progress-text');
    modal.classList.remove('hidden');
    bar.style.width = '0%';
    text.textContent = 'æ­£åœ¨æ ¡é©—è¦å‰‡... (10%)';

    try {
      const steps = [
        { text: 'æ ¡é©—è¦å‰‡ä¸­...', progress: 20 },
        { text: 'é€²è¡Œç‰ˆé¢åµæ¸¬...', progress: 45 },
        { text: 'ç”¢ç”Ÿ JSON çµæ§‹...', progress: 70 },
        { text: 'è¼¸å‡ºä¸­...', progress: 95 }
      ];
      let i = 0;
      const interval = setInterval(() => {
        if (i < steps.length) {
          text.textContent = `${steps[i].text} (${steps[i].progress}%)`;
          bar.style.width = steps[i].progress + '%';
          i++;
        }
      }, 2000);

      const res = await fetch('/process', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ rules: rules, filename: uploadedFilename })
      });

      clearInterval(interval);
      let data = {};
      try { data = await res.json(); } catch { data = { error: 'ä¼ºæœå™¨å›å‚³é JSON æ ¼å¼' }; }

      if (res.ok) {
        bar.style.width = '100%';
        text.textContent = 'âœ… è™•ç†å®Œæˆ (100%)';
        setTimeout(() => modal.classList.add('hidden'), 1000);
        showToast(data.message || "âœ… è™•ç†å®Œæˆ", "success");
        document.getElementById('download-section').classList.remove('hidden');
        const btn = document.getElementById('download-btn');
        if (data.json_filename) {
          btn.href = `/download/${data.json_filename}`;
          btn.download = data.json_filename;
        }
      } else {
        text.textContent = 'âŒ è™•ç†å¤±æ•—';
        bar.style.width = '100%';
        showToast(data.error || "âŒ è™•ç†å¤±æ•—", "error");
      }
    } catch (err) {
      text.textContent = 'âš ï¸ åŸ·è¡ŒéŒ¯èª¤';
      bar.style.width = '100%';
      showToast("âŒ åŸ·è¡Œç™¼ç”ŸéŒ¯èª¤", "error");
      console.error(err);
    }
  });
});

let uploadedFileName = "";

document.getElementById("uploadForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const fileInput = document.getElementById("file");
  const formData = new FormData();
  formData.append("file", fileInput.files[0]);

  const uploadRes = await fetch("/upload", { method: "POST", body: formData });
  const uploadData = await uploadRes.json();

  if (uploadData.filename) {
    uploadedFileName = uploadData.filename;
    console.log("âœ… ä¸Šå‚³å®Œæˆï¼š", uploadedFileName);

    // æ¥è‘—å‘¼å« /process é–‹å§‹è§£æ
    const processRes = await fetch("/process", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ filename: uploadedFileName, rules: "" })
    });
    const processData = await processRes.json();

    if (processData.json_file) {
      const section = document.getElementById("download-section");
      const btn = document.getElementById("download-btn");
      btn.href = `/download/${processData.json_file}`;
      btn.download = processData.json_file;
      section.classList.remove("hidden");
    }
  }
});
</script>






</body>
</html>
